"use strict";dotclear.dmScheduledPostsCount=e=>{dotclear.services("dmScheduledPostsCount",(d=>{try{const t=JSON.parse(d);if(!t?.success)return void console.log(dotclear.debug&&t?.message?t.message:"Dotclear REST server error");if(t?.payload.ret){const d=t.payload.count;if(void 0!==d&&d!=dotclear.dbScheduledPostsCount_Counter){const t=e.attr("href"),s=(t.includes("?")?"&":"?")+"status=-1",o=`${t}${s}`,l=$(`#dashboard-main #icons p a[href="${o}"]`);if(l.length){const e=l.children("span.db-icon-title-dm-scheduled");e.length&&e.text(d)}else if(""!=d){const t=` <a href="${o}"><span class="db-icon-title-dm-scheduled">${d}</span></a>`;e.after(t)}dotclear.dbScheduledPostsCount_Counter=d}}}catch(e){console.log(e)}}),(e=>{console.log(e)}),!0,{json:1})},dotclear.dmLastScheduledRows=()=>{dotclear.services("dmLastScheduledRows",(e=>{try{const d=JSON.parse(e);if(!d?.success)return void console.log(dotclear.debug&&d?.message?d.message:"Dotclear REST server error");if(d?.payload.ret){$("#scheduled-posts ul").length&&$("#scheduled-posts ul").remove(),$("#scheduled-posts p").length&&$("#scheduled-posts p").remove();const e=new Date,t=e.toLocaleTimeString();$("#scheduled-posts h3").after(d.payload.list),dotclear.badge($("#scheduled-posts"),{id:"dmsp",value:`<time datetime="${e.toISOString()}">${t}</time>`,type:"info"}),$.expandContent({lines:$("#scheduled-posts li.line"),callback:dotclear.dmScheduledPostsView}),$("#scheduled-posts ul").addClass("expandable")}}catch(e){console.log(e)}}),(e=>{console.log(e)}),!0,{json:1})},dotclear.dmScheduledCheck=()=>{dotclear.services("dmScheduledCheck",(e=>{try{const d=JSON.parse(e);if(!d?.success)return void console.log(dotclear.debug&&d?.message?d.message:"Dotclear REST server error");d?.payload.ret&&dotclear.dmLastScheduledRows()}catch(e){console.log(e)}}),(e=>{console.log(e)}),!0,{json:1})},dotclear.dmScheduledPostsView=(e,d="toggle",t=null)=>{if(null==$(e).attr("id"))return;const s=$(e).attr("id").substring(4),o=`dmspe${s}`;let l=document.getElementById(o);l?($(l).toggle(),$(e).toggleClass("expand")):dotclear.getEntryContent(s,(d=>{if(d)return l=document.createElement("li"),l.id=o,l.className="expand",$(l).append(d),$(e).addClass("expand"),void e.parentNode.insertBefore(l,e.nextSibling);$(e).toggleClass("expand")}),{clean:t.metaKey,length:300})},$((()=>{if(Object.assign(dotclear,dotclear.getData("dm_scheduled")),$.expandContent({lines:$("#scheduled-posts li.line"),callback:dotclear.dmScheduledPostsView}),$("#scheduled-posts ul").addClass("expandable"),dotclear.dmScheduled_Monitor&&(dotclear.dmScheduledCheck(),dotclear.dmScheduled_Timer=setInterval(dotclear.dmScheduledCheck,1e3*(dotclear.dbScheduledPostsCount_Timer||300))),!dotclear.dmScheduled_Counter)return;let e=$('#dashboard-main #icons p a[href="posts.php"]');e.length||(e=$("#dashboard-main #icons p #icon-process-posts-fav")),e.length&&(dotclear.dmScheduledPostsCount(e),dotclear.dbScheduledPostsCount_Timer=setInterval(dotclear.dmScheduledPostsCount,1e3*(dotclear.dmScheduled_Interval||300),e))}));
