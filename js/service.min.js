"use strict";dotclear.dmScheduledPostsCount=e=>{dotclear.services("dmScheduledPostsCount",(d=>{try{const s=JSON.parse(d);if(!s?.success)return void console.log(dotclear.debug&&s?.message?s.message:"Dotclear REST server error");if(s?.payload.ret){const d=s.payload.count;if(void 0!==d&&d!=dotclear.dbScheduledPostsCount_Counter){const s=e.attr("href"),t=(s.includes("?")?"&":"?")+"status=-1",o=`${s}${t}`;let l=$(`#dashboard-main #icons p a[href="${o}"]`);if(l.length){const e=l.children("span.db-icon-title-dm-scheduled");e.length&&e.text(d)}else if(""!=d&&e.length){const s=` <a href="${o}"><span class="db-icon-title-dm-scheduled">${d}</span></a>`;e.after(s)}dotclear.dbScheduledPostsCount_Counter=d}}}catch(e){console.log(e)}}),(e=>{console.log(e)}),!0,{json:1})},dotclear.dmLastScheduledRows=()=>{dotclear.services("dmLastScheduledRows",(e=>{try{const d=JSON.parse(e);if(!d?.success)return void console.log(dotclear.debug&&d?.message?d.message:"Dotclear REST server error");if(d?.payload.ret){$("#scheduled-posts ul").length&&$("#scheduled-posts ul").remove(),$("#scheduled-posts p").length&&$("#scheduled-posts p").remove();const e=new Date,s=e.toLocaleTimeString();$("#scheduled-posts h3").after(d.payload.list),dotclear.badge($("#scheduled-posts"),{id:"dmsp",value:`<time datetime="${e.toISOString()}">${s}</time>`,type:"info"}),$.expandContent({lines:$("#scheduled-posts li.line"),callback:dotclear.dmScheduledPostsView}),$("#scheduled-posts ul").addClass("expandable")}}catch(e){console.log(e)}}),(e=>{console.log(e)}),!0,{json:1})},dotclear.dmScheduledCheck=()=>{dotclear.services("dmScheduledCheck",(e=>{try{const d=JSON.parse(e);if(!d?.success)return void console.log(dotclear.debug&&d?.message?d.message:"Dotclear REST server error");d?.payload.ret&&dotclear.dmLastScheduledRows()}catch(e){console.log(e)}}),(e=>{console.log(e)}),!0,{json:1})},dotclear.dmScheduledPostsView=(e,d="toggle",s=null)=>{if(null==$(e).attr("id"))return;const t=$(e).attr("id").substr(4),o=`dmspe${t}`;let l=document.getElementById(o);l?($(l).toggle(),$(e).toggleClass("expand")):dotclear.getEntryContent(t,(d=>{d?(l=document.createElement("li"),l.id=o,l.className="expand",$(l).append(d),$(e).addClass("expand"),e.parentNode.insertBefore(l,e.nextSibling)):$(e).toggleClass("expand")}),{clean:s.metaKey,length:300})},$((()=>{if(Object.assign(dotclear,dotclear.getData("dm_scheduled")),$.expandContent({lines:$("#scheduled-posts li.line"),callback:dotclear.dmScheduledPostsView}),$("#scheduled-posts ul").addClass("expandable"),dotclear.dmScheduled_Monitor&&(dotclear.dmScheduledCheck(),dotclear.dmScheduled_Timer=setInterval(dotclear.dmScheduledCheck,3e5)),dotclear.dmScheduled_Counter){const e=$('#dashboard-main #icons p a[href="posts.php"]');e.length||(e=$("#dashboard-main #icons p #icon-process-posts-fav")),e.length&&(dotclear.dmScheduledPostsCount(e),dotclear.dbScheduledPostsCount_Timer=setInterval(dotclear.dmScheduledPostsCount,3e5,e))}}));
