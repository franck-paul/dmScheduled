"use strict";dotclear.dmScheduledPostsCount=()=>{dotclear.services("dmScheduledPostsCount",(e=>{try{const d=JSON.parse(e);if(!d?.success)return void console.log(dotclear.debug&&d?.message?d.message:"Dotclear REST server error");if(d?.payload.ret){const e=d.payload.count;if(void 0!==e&&e!=dotclear.dbScheduledPostsCount_Counter){let d=$('#dashboard-main #icons p a[href="posts.php?status=-1"]');if(d.length){const s=d.children("span.db-icon-title-dm-scheduled");s.length&&s.text(e)}else if(""!=e&&(d=$('#dashboard-main #icons p a[href="posts.php"]'),d.length)){const s=` <a href="posts.php?status=-1"><span class="db-icon-title-dm-scheduled">${e}</span></a>`;d.after(s)}dotclear.dbScheduledPostsCount_Counter=e}}}catch(e){console.log(e)}}),(e=>{console.log(e)}),!0,{json:1})},dotclear.dmLastScheduledRows=()=>{dotclear.services("dmLastScheduledRows",(e=>{try{const d=JSON.parse(e);if(!d?.success)return void console.log(dotclear.debug&&d?.message?d.message:"Dotclear REST server error");if(d?.payload.ret){$("#scheduled-posts ul").length&&$("#scheduled-posts ul").remove(),$("#scheduled-posts p").length&&$("#scheduled-posts p").remove();const e=new Date,s=e.toLocaleTimeString();$("#scheduled-posts h3").after(d.payload.list),dotclear.badge($("#scheduled-posts"),{id:"dmsp",value:`<time datetime="${e.toISOString()}">${s}</time>`,type:"info"}),$.expandContent({lines:$("#scheduled-posts li.line"),callback:dotclear.dmScheduledPostsView}),$("#scheduled-posts ul").addClass("expandable")}}catch(e){console.log(e)}}),(e=>{console.log(e)}),!0,{json:1})},dotclear.dmScheduledCheck=()=>{dotclear.services("dmScheduledCheck",(e=>{try{const d=JSON.parse(e);if(!d?.success)return void console.log(dotclear.debug&&d?.message?d.message:"Dotclear REST server error");d?.payload.ret&&dotclear.dmLastScheduledRows()}catch(e){console.log(e)}}),(e=>{console.log(e)}),!0,{json:1})},dotclear.dmScheduledPostsView=(e,d="toggle",s=null)=>{if(null==$(e).attr("id"))return;const t=$(e).attr("id").substr(4),o=`dmspe${t}`;let l=document.getElementById(o);l?($(l).toggle(),$(e).toggleClass("expand")):dotclear.getEntryContent(t,(d=>{d?(l=document.createElement("li"),l.id=o,l.className="expand",$(l).append(d),$(e).addClass("expand"),e.parentNode.insertBefore(l,e.nextSibling)):$(e).toggleClass("expand")}),{clean:s.metaKey,length:300})},$((()=>{if(Object.assign(dotclear,dotclear.getData("dm_scheduled")),$.expandContent({lines:$("#scheduled-posts li.line"),callback:dotclear.dmScheduledPostsView}),$("#scheduled-posts ul").addClass("expandable"),dotclear.dmScheduled_Monitor&&(dotclear.dmScheduledCheck(),dotclear.dmScheduled_Timer=setInterval(dotclear.dmScheduledCheck,3e5)),dotclear.dmScheduled_Counter){$('#dashboard-main #icons p a[href="posts.php"]').length&&(dotclear.dmScheduledPostsCount(),dotclear.dbScheduledPostsCount_Timer=setInterval(dotclear.dmScheduledPostsCount,3e5))}}));
