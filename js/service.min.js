"use strict";dotclear.ready(()=>{dotclear.dmScheduled=dotclear.getData("dm_scheduled");const e=(e,o="toggle",t=null)=>{dotclear.dmViewPost(e,"dmspe",t.metaKey)},o=e=>{dotclear.services("dmScheduledPostsCount",o=>{try{const t=JSON.parse(o);if(!t?.success)return void console.log(dotclear.debug&&t?.message?t.message:"Dotclear REST server error");if(t?.payload.ret){const o=t.payload.count;if(void 0!==o&&o!==dotclear.dmScheduled.counter){const t=e.getAttribute("href"),c=(t.includes("?")?"&":"?")+"status=-1",d=`${t}${c}`,l=document.querySelector(`#dashboard-main #icons p a[href="${d}"]`);if(l){const e=l.querySelector("span.db-icon-title-dm-scheduled");e&&(e.textContent=o)}else if(""!==o){const t=` <a href="${d}"><span class="db-icon-title-dm-scheduled">${o}</span></a>`;e.insertAdjacentHTML("afterEnd",t)}dotclear.mbScheduled.counter=o}}}catch(e){console.log(e)}},e=>{console.log(e)},!0,{json:1})},t=()=>{dotclear.services("dmScheduledCheck",o=>{try{const t=JSON.parse(o);if(!t?.success)return void console.log(dotclear.debug&&t?.message?t.message:"Dotclear REST server error");t?.payload.ret&&dotclear.services("dmLastScheduledRows",o=>{try{const t=JSON.parse(o);if(!t?.success)return void console.log(dotclear.debug&&t?.message?t.message:"Dotclear REST server error");if(t?.payload.ret){for(const e of document.querySelectorAll("#scheduled-posts ul"))e.remove();for(const e of document.querySelectorAll("#scheduled-posts p"))e.remove();const o=new Date,c=o.toLocaleTimeString(),d=document.querySelector("#scheduled-posts h3");d?.insertAdjacentHTML("afterend",t.payload.list),dotclear.badge(document.querySelector("#scheduled-posts"),{id:"dmsp",value:`<time datetime="${o.toISOString()}">${c}</time>`,type:"info"}),dotclear.expandContent({lines:document.querySelectorAll("#scheduled-posts li.line"),callback:e});for(const e of document.querySelectorAll("#scheduled-posts ul"))e.classList.add("expandable")}}catch(e){console.log(e)}},e=>{console.log(e)},!0,{json:1})}catch(e){console.log(e)}},e=>{console.log(e)},!0,{json:1})};dotclear.expandContent({lines:document.querySelectorAll("#scheduled-posts li.line"),callback:e});for(const e of document.querySelectorAll("#scheduled-posts ul"))e.classList.add("expandable");if(dotclear.dmScheduled.monitor&&(t(),dotclear.dmScheduled.timerCheck=setInterval(t,1e3*(dotclear.dmScheduled.interval||300))),!dotclear.dmScheduled.counter)return;let c=document.querySelector('#dashboard-main #icons p a[href="posts.php"]');c||(c=document.querySelector("#dashboard-main #icons p #icon-process-posts-fav")),c.length&&(o(c),dotclear.dmScheduled.timerCount=setInterval(o,1e3*(dotclear.dmScheduled.interval||300),c))});
